<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Keyfun | Lyrics</title>


	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
	<link rel="stylesheet" href="/css/basics.css" />
	<link rel="stylesheet" href="/css/lyrics.css" />
	<link rel="stylesheet" href="/css/keyboard.css" />
	<link rel="stylesheet" href="/css/rating.css" />

	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Kode+Mono:wght@400..700&family=Nova+Mono&family=Orbitron:wght@400..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=VT323&display=swap" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.1.0/fontfaceobserver.standalone.js"></script>

	<link rel="shortcut icon" href="/assets/icon/logo.ico" type="image/x-icon" />
</head>

<body>

	<!-- ***** Preloader Start ***** -->
	<%- include('partials/preload.ejs') %>

		<header>
			<style>
				#timer:hover {
					background-color: transparent;
					z-index: 100000 !important;
					border-width: 2px;
				}

				#timer:focus {
					outline: none !important;
					box-shadow: none;
				}

				#timer:active {
					box-shadow: 0 0 0 .2rem rgba(248, 249, 250, .5);
				}

				#timer {
					border-color: #fff2;
					color: #eeed;
				}
			</style>
			<div class="top-left">
				<img id="logoimg" onclick="location.href='/'" class="logo" src="/assets/images/logo.png" />
				<button class="btn btn-outline-light"
					onclick="localStorage.getItem('timerMode') == 'ctup' ? localStorage.setItem('timerMode', 'ctdwn') : localStorage.setItem('timerMode', 'ctup')"
					id="timer">00:00</button>
				<!-- <button class="btn btn-outline-light" id="wpm">60WPM</button> -->
			</div>
		</header>

		<!-- Overlay / Loader... -->
		<div class="overlay-loader" style="display: none">
			<div class="spinner-container center" style="display: none">
				<div class="spinner-border text-warning" style="opacity: 0.5; width: 3rem; height: 3rem" role="status">
					<span class="visually-hidden"></span>
				</div>
			</div>
			<div id="play" class="btn" data-id="<%= music._id %>" style="display: none">
				<i class="bi bi-play-circle text-secondary play-icon" style="opacity: 0.7"></i>
			</div>
		</div>

		<div class="whole-body">
			<video id="music-video" class="music-video">
				<source src="<%= music.video %>" type="video/mp4" />
				<track id="subtitle-track" label="English" kind="subtitles" srclang="en" data-src="<%= music.lyrics %>" default>
				Your browser does not support HTML5 video.
			</video>

			<input type="hidden" name="lyrics" value="<%= music.lyrics %>" />
		</div>

		<div class="lyrics-container text-light" id="lyrics-container" style="display: none">
			♪ ... ♪
		</div>

		<div class="keyboard-container" id="keyboard-container" style="display: none">
			<%- include('partials/keyboard.ejs') %>
		</div>
		<div class="ratings-parent" style="display: none">
			<%- include('partials/rating.ejs') %>
		</div>

		<div class="stats-container" style="display: none">
			<%- include('partials/stats.ejs') %>
		</div>

		<h4 id="volume" style="
        position: absolute;
        right: 5em;
        bottom: 2em;
        transform: translateX(-50%);
        color: #5e86e7;
        display: flex;
      	font-size: 1.25rem;
				color: #f7f7f7; 
				justify-content: center;
				align-items: center;
				transition: 1s ease-in-out;
				">
			<i style="display: none" class="up fas fa-angle-double-up"></i>
			<i style="display: none" class="down fas fa-angle-double-down"></i>
			&nbsp;&nbsp;
			<span style="font-size: 1.75rem;"></span>
		</h4>

		<style>
			@keyframes zoom-in-out {
				0% {
					transform: scale(1);
				}

				100% {
					transform: scale(1.1);
				}
			}
		</style>
		<h4 id="seek" style="
        position: fixed;
				top: 50%;
        transform: translateY(-50%);
        color: #5e86e7;
        display: none;
				flex: content;
      	font-size: 1.75rem;
				color: #f7f7f7; 
				align-items: center;
				justify-content: center;
				opacity: 0.95;
				animation: zoom-in-out 0.7s normal;
				">
			<i class="fwd fas fa-forward"></i>
			<i class="back fas fa-backward"></i>
			<!-- &nbsp; -->
			<!-- /* transition: animation 0.5s ease-in-out; */ -->
			<span style="font-size: 2rem;"></span>
		</h4>

		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

		<script>
			window.musicId = '<%= music._id %>';

			console.log('musicId:', musicId);
		</script>
		<script src="/js/lyrics.js" defer></script>
		<script src="/js/styles.js"></script>
		<script src="/js/keyboard.js"></script>

		<script>
			$(document).ready(function () {
				$('.rating input[name="rating"]').on('change', function (e) {
					e.preventDefault();
					$('.give-btn').attr('data-rating', -1 * parseInt($(this).val()) + 6);
				});

				$('.give-btn').click(function (e) {
					e.preventDefault();
					let rating = this.dataset.rating;

					if (!rating || rating === '')
						rating = -1 * parseInt($('.rating input[name="rating"]').val()) + 6;

					console.log('<%= music._id%>', rating);
					fetch('/update/rating', {
						method: 'PUT',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ rating, musicId: '<%= music._id%>' }),
					});
					$('.ratings-parent').hide();
					$('.stats-container').find('.close-stats').hide();
					$('.stats-container').find('.favor').show();
					$('.stats-container').find('.replay').show();
					$('.stats-container').show();
				});
			});
		</script>
</body>

</html>